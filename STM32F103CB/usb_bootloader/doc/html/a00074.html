<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>STM32F1_USB_bootloader: USB_bootloader</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">STM32F1_USB_bootloader
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00074.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">USB_bootloader</div>  </div>
</div><!--header-->
<div class="contents">

<p>USB_bootloader for the STM32F103 microcontroller.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:a00051"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html">usb_bootloader.h</a></td></tr>
<tr class="memdesc:a00051"><td class="mdescLeft">&#160;</td><td class="mdescRight">Header file for the stm32f103 USB bootloader. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gaeeec01180221fc32a831f91982f6311e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#gaeeec01180221fc32a831f91982f6311e">APP_ADDRESS</a>&#160;&#160;&#160;0x08003000</td></tr>
<tr class="memdesc:gaeeec01180221fc32a831f91982f6311e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Offset for the application starting address.  <a href="#gaeeec01180221fc32a831f91982f6311e">More...</a><br /></td></tr>
<tr class="separator:gaeeec01180221fc32a831f91982f6311e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga95dec08f7749dfca8c047c37a9bafb35"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga95dec08f7749dfca8c047c37a9bafb35"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga95dec08f7749dfca8c047c37a9bafb35">CMD_SETADDR</a>&#160;&#160;&#160;0x21</td></tr>
<tr class="memdesc:ga95dec08f7749dfca8c047c37a9bafb35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Command sent with wBlockNum == 0 as per ST implementation. <br /></td></tr>
<tr class="separator:ga95dec08f7749dfca8c047c37a9bafb35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga73d541696536a935eec42edc03359e96"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga73d541696536a935eec42edc03359e96"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga73d541696536a935eec42edc03359e96">CMD_ERASE</a>&#160;&#160;&#160;0x41</td></tr>
<tr class="memdesc:ga73d541696536a935eec42edc03359e96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Command sent with wBlockNum == 0 as per ST implementation. <br /></td></tr>
<tr class="separator:ga73d541696536a935eec42edc03359e96"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga1102a7b6b769cd34da407c00e1934c4e"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga1102a7b6b769cd34da407c00e1934c4e">usbdfu_getstatus</a> (usbd_device *usbd_dev, uint32_t *bwPollTimeout)</td></tr>
<tr class="memdesc:ga1102a7b6b769cd34da407c00e1934c4e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get USB Status.  <a href="#ga1102a7b6b769cd34da407c00e1934c4e">More...</a><br /></td></tr>
<tr class="separator:ga1102a7b6b769cd34da407c00e1934c4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga78274523a96522597188d4df64dd6ae2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga78274523a96522597188d4df64dd6ae2">usbdfu_getstatus_complete</a> (usbd_device *usbd_dev, struct usb_setup_data *req)</td></tr>
<tr class="memdesc:ga78274523a96522597188d4df64dd6ae2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Burn the program to the flash memory.  <a href="#ga78274523a96522597188d4df64dd6ae2">More...</a><br /></td></tr>
<tr class="separator:ga78274523a96522597188d4df64dd6ae2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga42c8980be108448e3a7f51377a740077"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga42c8980be108448e3a7f51377a740077">usbdfu_control_request</a> (usbd_device *usbd_dev, struct usb_setup_data *req, uint8_t **buf, uint16_t *len, void(**complete)(usbd_device *usbd_dev, struct usb_setup_data *req))</td></tr>
<tr class="memdesc:ga42c8980be108448e3a7f51377a740077"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle control requests from the host.  <a href="#ga42c8980be108448e3a7f51377a740077">More...</a><br /></td></tr>
<tr class="separator:ga42c8980be108448e3a7f51377a740077"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5a5b24acb952b3d09daf5d4fc92f4968"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga5a5b24acb952b3d09daf5d4fc92f4968">usbdfu_set_config</a> (usbd_device *usbd_dev, uint16_t wValue)</td></tr>
<tr class="memdesc:ga5a5b24acb952b3d09daf5d4fc92f4968"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the USB configuration.  <a href="#ga5a5b24acb952b3d09daf5d4fc92f4968">More...</a><br /></td></tr>
<tr class="separator:ga5a5b24acb952b3d09daf5d4fc92f4968"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga75a43739999d690b404b781292ec172e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga75a43739999d690b404b781292ec172e"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga75a43739999d690b404b781292ec172e">usbd_control_buffer</a> [1024]</td></tr>
<tr class="memdesc:ga75a43739999d690b404b781292ec172e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control buffer for device commands, 1024 bytes set by USB standard. <br /></td></tr>
<tr class="separator:ga75a43739999d690b404b781292ec172e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf9d74253688cff23148b18540d0408b8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaf9d74253688cff23148b18540d0408b8"></a>
enum dfu_state&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#gaf9d74253688cff23148b18540d0408b8">usbdfu_state</a> = STATE_DFU_IDLE</td></tr>
<tr class="memdesc:gaf9d74253688cff23148b18540d0408b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">DFU idle state. <br /></td></tr>
<tr class="separator:gaf9d74253688cff23148b18540d0408b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga03e627a8294530c5efa5823070ebbd18"><td class="memItemLeft" ><a class="anchor" id="ga03e627a8294530c5efa5823070ebbd18"></a>
struct {</td></tr>
<tr class="memitem:gac04c35ec34cfa3974bb2a34de799d995"><td class="memItemLeft" >
&#160;&#160;&#160;uint8_t&#160;&#160;&#160;<b>buf</b> [sizeof(<a class="el" href="a00074.html#ga75a43739999d690b404b781292ec172e">usbd_control_buffer</a>)]</td></tr>
<tr class="separator:gac04c35ec34cfa3974bb2a34de799d995"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf8d9058b71e5d7b3bfb38d7a9d3adaca"><td class="memItemLeft" >
&#160;&#160;&#160;uint16_t&#160;&#160;&#160;<b>len</b></td></tr>
<tr class="separator:gaf8d9058b71e5d7b3bfb38d7a9d3adaca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga337422e5049a372bd6d2a091802a7f44"><td class="memItemLeft" >
&#160;&#160;&#160;uint32_t&#160;&#160;&#160;<b>addr</b></td></tr>
<tr class="separator:ga337422e5049a372bd6d2a091802a7f44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga76c906aef040409e2b46bd1c612ee7dc"><td class="memItemLeft" >
&#160;&#160;&#160;uint16_t&#160;&#160;&#160;<b>blocknum</b></td></tr>
<tr class="separator:ga76c906aef040409e2b46bd1c612ee7dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga03e627a8294530c5efa5823070ebbd18"><td class="memItemLeft" valign="top">}&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga03e627a8294530c5efa5823070ebbd18">prog</a></td></tr>
<tr class="memdesc:ga03e627a8294530c5efa5823070ebbd18"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer to store a single command sent from host. <br /></td></tr>
<tr class="separator:ga03e627a8294530c5efa5823070ebbd18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf2dab4ea4560c93acc64b4418db49f84"><td class="memItemLeft" align="right" valign="top">const struct usb_device_descriptor&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#gaf2dab4ea4560c93acc64b4418db49f84">dev</a></td></tr>
<tr class="memdesc:gaf2dab4ea4560c93acc64b4418db49f84"><td class="mdescLeft">&#160;</td><td class="mdescRight">USB device descriptor.  <a href="#gaf2dab4ea4560c93acc64b4418db49f84">More...</a><br /></td></tr>
<tr class="separator:gaf2dab4ea4560c93acc64b4418db49f84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2740b6d840100fbc9e568fcdbd4dfeb1"><td class="memItemLeft" align="right" valign="top">const struct usb_dfu_descriptor&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga2740b6d840100fbc9e568fcdbd4dfeb1">dfu_function</a></td></tr>
<tr class="memdesc:ga2740b6d840100fbc9e568fcdbd4dfeb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">USB DFU descriptor.  <a href="#ga2740b6d840100fbc9e568fcdbd4dfeb1">More...</a><br /></td></tr>
<tr class="separator:ga2740b6d840100fbc9e568fcdbd4dfeb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadb09e01af42e1eac344b2881599a102e"><td class="memItemLeft" align="right" valign="top">const struct usb_interface_descriptor&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#gadb09e01af42e1eac344b2881599a102e">iface</a></td></tr>
<tr class="memdesc:gadb09e01af42e1eac344b2881599a102e"><td class="mdescLeft">&#160;</td><td class="mdescRight">USB Interface descriptor.  <a href="#gadb09e01af42e1eac344b2881599a102e">More...</a><br /></td></tr>
<tr class="separator:gadb09e01af42e1eac344b2881599a102e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0479d91765cee306c29db9e366752051"><td class="memItemLeft" align="right" valign="top">const struct usb_interface&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga0479d91765cee306c29db9e366752051">ifaces</a> []</td></tr>
<tr class="memdesc:ga0479d91765cee306c29db9e366752051"><td class="mdescLeft">&#160;</td><td class="mdescRight">USB Interfaces.  <a href="#ga0479d91765cee306c29db9e366752051">More...</a><br /></td></tr>
<tr class="separator:ga0479d91765cee306c29db9e366752051"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga79fece8dc710f4eaf00c3f026ab2e4ae"><td class="memItemLeft" align="right" valign="top">const struct usb_config_descriptor&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#ga79fece8dc710f4eaf00c3f026ab2e4ae">config</a></td></tr>
<tr class="memdesc:ga79fece8dc710f4eaf00c3f026ab2e4ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">USB configuration.  <a href="#ga79fece8dc710f4eaf00c3f026ab2e4ae">More...</a><br /></td></tr>
<tr class="separator:ga79fece8dc710f4eaf00c3f026ab2e4ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf34cf0c102eb4cf7bc0df82cd25bf8ad"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00074.html#gaf34cf0c102eb4cf7bc0df82cd25bf8ad">usb_strings</a> []</td></tr>
<tr class="memdesc:gaf34cf0c102eb4cf7bc0df82cd25bf8ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">USB description strings.  <a href="#gaf34cf0c102eb4cf7bc0df82cd25bf8ad">More...</a><br /></td></tr>
<tr class="separator:gaf34cf0c102eb4cf7bc0df82cd25bf8ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>USB_bootloader for the STM32F103 microcontroller. </p>
<p>The USB bootloader is designed to upload new firmware on STM32F1 devices.</p>
<p>The bootloader can always be entered by:</p>
<ul>
<li>Holding Port A pin 1 high and cycle the power to the device.</li>
<li>Sending 8 null characters ( \0 ) sequentially through the USB port.</li>
<li>An occurance of a hard fault</li>
<li>Reset from independant watchdog timer.</li>
</ul>
<p>These events are triggered by the value stored in the first data register of the backup domain. If this register is used for another function the bootloader may not trigger from software as expected.</p>
<p>The majority of this bootloader is adapted from libopencm3 examples. Modifications have been made to trigger the events above.</p>
<dl class="section author"><dt>Author</dt><dd>Stuart Ianna </dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>June 2018 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>GNU GPLv3 </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>None </dd></dl>
<dl class="bug"><dt><b><a class="el" href="a00001.html#_bug000041">Bug:</a></b></dt><dd>At some instances, the power to the MCU needs to be reset after new firmware is loaded. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="a00002.html#_todo000021">Todo:</a></b></dt><dd></dd></dl>
<dl class="section user"><dt>Compilers</dt><dd><ul>
<li>arm-none-eabi-gcc (15:4.9.3+svn231177-1) 4.9.3 20150529 (prerelease) </li>
</ul>
</dd></dl>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="gaeeec01180221fc32a831f91982f6311e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APP_ADDRESS&#160;&#160;&#160;0x08003000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Offset for the application starting address. </p>
<p>This would only need to be changed if the bootloader somehow got larger. </p>

<p>Definition at line <a class="el" href="a00051_source.html#l00059">59</a> of file <a class="el" href="a00051_source.html">usb_bootloader.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga42c8980be108448e3a7f51377a740077"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int usbdfu_control_request </td>
          <td>(</td>
          <td class="paramtype">usbd_device *&#160;</td>
          <td class="paramname"><em>usbd_dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct usb_setup_data *&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(**)(usbd_device *usbd_dev, struct usb_setup_data *req)&#160;</td>
          <td class="paramname"><em>complete</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle control requests from the host. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">usbd_dev</td><td>Pointer to the usb device </td></tr>
    <tr><td class="paramname">req</td><td>USB setup data </td></tr>
    <tr><td class="paramname">buf</td><td>Buffer to store sent data. </td></tr>
    <tr><td class="paramname">len</td><td>Length of the data buffer. </td></tr>
    <tr><td class="paramname">complete</td><td>Funtion pointer to handler for USB command. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>1 if valid control command was received.</li>
<li>0 if invalid control command was received. </li>
</ul>
</dd></dl>

<p>Definition at line <a class="el" href="a00050_source.html#l00157">157</a> of file <a class="el" href="a00050_source.html">usb_bootloader.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00074_ga42c8980be108448e3a7f51377a740077_cgraph.png" border="0" usemap="#a00074_ga42c8980be108448e3a7f51377a740077_cgraph" alt=""/></div>
<map name="a00074_ga42c8980be108448e3a7f51377a740077_cgraph" id="a00074_ga42c8980be108448e3a7f51377a740077_cgraph">
<area shape="rect" id="node2" href="a00074.html#ga1102a7b6b769cd34da407c00e1934c4e" title="Get USB Status. " alt="" coords="241,5,363,32"/>
<area shape="rect" id="node3" href="a00074.html#ga78274523a96522597188d4df64dd6ae2" title="Burn the program to the flash memory. " alt="" coords="211,56,393,83"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga1102a7b6b769cd34da407c00e1934c4e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t usbdfu_getstatus </td>
          <td>(</td>
          <td class="paramtype">usbd_device *&#160;</td>
          <td class="paramname"><em>usbd_dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>bwPollTimeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get USB Status. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">usbd_dev</td><td>This parameter is not used. </td></tr>
    <tr><td class="paramname">bwPollTimeout</td><td>Timeout time. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>DFU device status. This function allways return DFU_STATUS_OK. </dd></dl>

<p>Definition at line <a class="el" href="a00050_source.html#l00060">60</a> of file <a class="el" href="a00050_source.html">usb_bootloader.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga78274523a96522597188d4df64dd6ae2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usbdfu_getstatus_complete </td>
          <td>(</td>
          <td class="paramtype">usbd_device *&#160;</td>
          <td class="paramname"><em>usbd_dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct usb_setup_data *&#160;</td>
          <td class="paramname"><em>req</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Burn the program to the flash memory. </p>
<p>This function is called when new information is received from the host. It has two functions:</p><ol type="1">
<li>Data is programmed to the flash memory, based on the set address and erase state.</li>
<li>When all data is programmed, the program disables all peripherals, writes 1 to the backup domain so on reset the bootloader knows a program is present on reset. <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">usbd_dev</td><td>This parameter is not used. </td></tr>
    <tr><td class="paramname">req</td><td>This parameter is not used. </td></tr>
  </table>
  </dd>
</dl>
</li>
</ol>

<p>Definition at line <a class="el" href="a00050_source.html#l00080">80</a> of file <a class="el" href="a00050_source.html">usb_bootloader.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga5a5b24acb952b3d09daf5d4fc92f4968"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usbdfu_set_config </td>
          <td>(</td>
          <td class="paramtype">usbd_device *&#160;</td>
          <td class="paramname"><em>usbd_dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>wValue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the USB configuration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">usbd_dev</td><td>Pointer to the usb device </td></tr>
    <tr><td class="paramname">wValue</td><td>This parameter is not used. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00050_source.html#l00210">210</a> of file <a class="el" href="a00050_source.html">usb_bootloader.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00074_ga5a5b24acb952b3d09daf5d4fc92f4968_cgraph.png" border="0" usemap="#a00074_ga5a5b24acb952b3d09daf5d4fc92f4968_cgraph" alt=""/></div>
<map name="a00074_ga5a5b24acb952b3d09daf5d4fc92f4968_cgraph" id="a00074_ga5a5b24acb952b3d09daf5d4fc92f4968_cgraph">
<area shape="rect" id="node2" href="a00074.html#ga42c8980be108448e3a7f51377a740077" title="Handle control requests from the host. " alt="" coords="181,31,339,57"/>
<area shape="rect" id="node3" href="a00074.html#ga1102a7b6b769cd34da407c00e1934c4e" title="Get USB Status. " alt="" coords="417,5,539,32"/>
<area shape="rect" id="node4" href="a00074.html#ga78274523a96522597188d4df64dd6ae2" title="Burn the program to the flash memory. " alt="" coords="387,56,569,83"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ga79fece8dc710f4eaf00c3f026ab2e4ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const struct usb_config_descriptor config</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">    .bLength = USB_DT_CONFIGURATION_SIZE,</div><div class="line">    .bDescriptorType = USB_DT_CONFIGURATION,</div><div class="line">    .wTotalLength = 0,</div><div class="line">    .bNumInterfaces = 1,</div><div class="line">    .bConfigurationValue = 1,</div><div class="line">    .iConfiguration = 0,</div><div class="line">    .bmAttributes = 0xC0,</div><div class="line">    .bMaxPower = 0x32,</div><div class="line">    .interface = <a class="code" href="a00074.html#ga0479d91765cee306c29db9e366752051">ifaces</a>,</div><div class="line">}</div><div class="ttc" id="a00074_html_ga0479d91765cee306c29db9e366752051"><div class="ttname"><a href="a00074.html#ga0479d91765cee306c29db9e366752051">ifaces</a></div><div class="ttdeci">const struct usb_interface ifaces[]</div><div class="ttdoc">USB Interfaces. </div><div class="ttdef"><b>Definition:</b> <a href="a00051_source.html#l00146">usb_bootloader.h:146</a></div></div>
</div><!-- fragment -->
<p>USB configuration. </p>

<p>Definition at line <a class="el" href="a00051_source.html#l00154">154</a> of file <a class="el" href="a00051_source.html">usb_bootloader.h</a>.</p>

</div>
</div>
<a class="anchor" id="gaf2dab4ea4560c93acc64b4418db49f84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const struct usb_device_descriptor dev</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">    .bLength = USB_DT_DEVICE_SIZE,</div><div class="line">    .bDescriptorType = USB_DT_DEVICE,</div><div class="line">    .bcdUSB = 0x0200,</div><div class="line">    .bDeviceClass = 0,</div><div class="line">    .bDeviceSubClass = 0,</div><div class="line">    .bDeviceProtocol = 0,</div><div class="line">    .bMaxPacketSize0 = 64,</div><div class="line">    .idVendor = 0x0483,</div><div class="line">    .idProduct = 0xDF11,</div><div class="line">    .bcdDevice = 0x0200,</div><div class="line">    .iManufacturer = 1,</div><div class="line">    .iProduct = 2,</div><div class="line">    .iSerialNumber = 3,</div><div class="line">    .bNumConfigurations = 1,</div><div class="line">}</div></div><!-- fragment -->
<p>USB device descriptor. </p>

<p>Definition at line <a class="el" href="a00051_source.html#l00093">93</a> of file <a class="el" href="a00051_source.html">usb_bootloader.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga2740b6d840100fbc9e568fcdbd4dfeb1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const struct usb_dfu_descriptor dfu_function</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">    .bLength = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>usb_dfu_descriptor),</div><div class="line">    .bDescriptorType = DFU_FUNCTIONAL,</div><div class="line">    .bmAttributes = USB_DFU_CAN_DOWNLOAD | USB_DFU_WILL_DETACH,</div><div class="line">    .wDetachTimeout = 255,</div><div class="line">    .wTransferSize = 1024,</div><div class="line">    .bcdDFUVersion = 0x011A,</div><div class="line">}</div></div><!-- fragment -->
<p>USB DFU descriptor. </p>

<p>Definition at line <a class="el" href="a00051_source.html#l00113">113</a> of file <a class="el" href="a00051_source.html">usb_bootloader.h</a>.</p>

</div>
</div>
<a class="anchor" id="gadb09e01af42e1eac344b2881599a102e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const struct usb_interface_descriptor iface</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">    .bLength = USB_DT_INTERFACE_SIZE,</div><div class="line">    .bDescriptorType = USB_DT_INTERFACE,</div><div class="line">    .bInterfaceNumber = 0,</div><div class="line">    .bAlternateSetting = 0,</div><div class="line">    .bNumEndpoints = 0,</div><div class="line">    .bInterfaceClass = 0xFE, </div><div class="line">    .bInterfaceSubClass = 1,</div><div class="line">    .bInterfaceProtocol = 2,</div><div class="line"></div><div class="line">    </div><div class="line">    .iInterface = 4,</div><div class="line"></div><div class="line">    .extra = &amp;<a class="code" href="a00074.html#ga2740b6d840100fbc9e568fcdbd4dfeb1">dfu_function</a>,</div><div class="line">    .extralen = <span class="keyword">sizeof</span>(<a class="code" href="a00074.html#ga2740b6d840100fbc9e568fcdbd4dfeb1">dfu_function</a>),</div><div class="line">}</div><div class="ttc" id="a00074_html_ga2740b6d840100fbc9e568fcdbd4dfeb1"><div class="ttname"><a href="a00074.html#ga2740b6d840100fbc9e568fcdbd4dfeb1">dfu_function</a></div><div class="ttdeci">const struct usb_dfu_descriptor dfu_function</div><div class="ttdoc">USB DFU descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="a00051_source.html#l00113">usb_bootloader.h:113</a></div></div>
</div><!-- fragment -->
<p>USB Interface descriptor. </p>

<p>Definition at line <a class="el" href="a00051_source.html#l00125">125</a> of file <a class="el" href="a00051_source.html">usb_bootloader.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga0479d91765cee306c29db9e366752051"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const struct usb_interface ifaces[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {{</div><div class="line">    .num_altsetting = 1,</div><div class="line">    .altsetting = &amp;<a class="code" href="a00074.html#gadb09e01af42e1eac344b2881599a102e">iface</a>,</div><div class="line">}}</div><div class="ttc" id="a00074_html_gadb09e01af42e1eac344b2881599a102e"><div class="ttname"><a href="a00074.html#gadb09e01af42e1eac344b2881599a102e">iface</a></div><div class="ttdeci">const struct usb_interface_descriptor iface</div><div class="ttdoc">USB Interface descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="a00051_source.html#l00125">usb_bootloader.h:125</a></div></div>
</div><!-- fragment -->
<p>USB Interfaces. </p>

<p>Definition at line <a class="el" href="a00051_source.html#l00146">146</a> of file <a class="el" href="a00051_source.html">usb_bootloader.h</a>.</p>

</div>
</div>
<a class="anchor" id="gaf34cf0c102eb4cf7bc0df82cd25bf8ad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* usb_strings[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">    <span class="stringliteral">&quot;STM32F1 USB DFU Device&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;PA1 High on power to enter bootloader&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;V1.0&quot;</span>,</div><div class="line">    </div><div class="line">    <span class="stringliteral">&quot;@Internal Flash   /0x08000000/8*001Ka,56*001Kg&quot;</span>,</div><div class="line">}</div></div><!-- fragment -->
<p>USB description strings. </p>

<p>Definition at line <a class="el" href="a00051_source.html#l00169">169</a> of file <a class="el" href="a00051_source.html">usb_bootloader.h</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 16 2018 18:06:00 for STM32F1_USB_bootloader by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
