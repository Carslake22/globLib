<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>GlobLib: CLOCK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GlobLib
   </div>
   <div id="projectbrief">HAL and API libraries for MCUs and hardware.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../../../doc/doxygen/html/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../../../common/doc/doxygen/html/index.html"><span>Common</span></a></li>
      <li><a href="index.html"><span>ATTINY13A</span></a></li>
      <li><a href="../../../../STM32F103CB/doc/doxygen/html/index.html"><span>STM32F103CB</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__CLOCK.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">CLOCK<div class="ingroups"><a class="el" href="group__ATTINY13A.html">ATTINY13A</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This module contains low level functions modifying clock parameters.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:attiny13a__clock_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attiny13a__clock_8h.html">attiny13a_clock.h</a></td></tr>
<tr class="memdesc:attiny13a__clock_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Header file for attiny13a CLOCK. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga1c0fb75e4c7de12f534ad46014d35611"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__DEBUG.html#ga90d6d08ec193c9751b20ce1d143b7f3c">mcu_error</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CLOCK.html#ga1c0fb75e4c7de12f534ad46014d35611">CLOCK_setSpeed</a> (<a class="el" href="group__CLOCK.html#ga40243a242aa3fc9a23d8555457058312">clock_option</a> option)</td></tr>
<tr class="memdesc:ga1c0fb75e4c7de12f534ad46014d35611"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the final clock speed of the device.  <a href="#ga1c0fb75e4c7de12f534ad46014d35611">More...</a><br /></td></tr>
<tr class="separator:ga1c0fb75e4c7de12f534ad46014d35611"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3199fc3077a8e5f69aaaea0e45c28927"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CLOCK.html#ga3199fc3077a8e5f69aaaea0e45c28927">CLOCK_getSpeed</a> (void)</td></tr>
<tr class="memdesc:ga3199fc3077a8e5f69aaaea0e45c28927"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current clock speed of the device.  <a href="#ga3199fc3077a8e5f69aaaea0e45c28927">More...</a><br /></td></tr>
<tr class="separator:ga3199fc3077a8e5f69aaaea0e45c28927"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad7074133d8bc7d5bfe85f43bd813e378"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CLOCK.html#gad7074133d8bc7d5bfe85f43bd813e378">CLOCK_getSpeedAlternate</a> (void)</td></tr>
<tr class="memdesc:gad7074133d8bc7d5bfe85f43bd813e378"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current clock divisor.  <a href="#gad7074133d8bc7d5bfe85f43bd813e378">More...</a><br /></td></tr>
<tr class="separator:gad7074133d8bc7d5bfe85f43bd813e378"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This module contains low level functions modifying clock parameters. </p>
<p>The ATTINY13A has a maximum clock speed of 9.6MHz for the internal RC oscillator. By default, on startup, the clock is set to internal oscillator with 9.6MHz frequency.</p>
<dl class="section note"><dt>Note</dt><dd>Clock switching needs to be done before any extra peripheral clocks are used!</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Stuart Ianna </dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>October 2018 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>GNU GPLv3 </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>None </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000002">Bug:</a></b></dt><dd>Switching between all clock options doesn't work well.<ul>
<li>Switch from internal ocsillator 64Mhz to a lower speed doesn't work</li>
</ul>
</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Add option for setting clock back to default option.</dd></dl>
<dl class="section user"><dt>Compilers</dt><dd><ul>
<li>avr-gcc 4.9.2</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Example Usage</dt><dd><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stm32f103cb_core.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;coms128.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;mpu6050.h&gt;</span></div><div class="line"></div><div class="line"><span class="comment">//Create a data structure for the device</span></div><div class="line">MPU6050 mpu;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"></div><div class="line">    <span class="comment">//This should be done before other peripherals are set up</span></div><div class="line">    <a class="code" href="group__CLOCK.html#ga1c0fb75e4c7de12f534ad46014d35611">CLOCK_setSpeed</a>(CLOCK_EX_8_OUT_72);</div><div class="line"></div><div class="line">    <span class="comment">//Serial communications</span></div><div class="line">    USART_setup(USART_1);</div><div class="line">    COMS(USART_1);</div><div class="line"></div><div class="line">    <span class="comment">//Print out clock freuqency</span></div><div class="line">    prints(<span class="stringliteral">&quot;Clock speed =&quot;</span>);</div><div class="line">    printl(<a class="code" href="group__CLOCK.html#ga3199fc3077a8e5f69aaaea0e45c28927">CLOCK_getSpeed</a>());</div><div class="line"></div><div class="line">    <span class="comment">//Done</span></div><div class="line">    <span class="keywordflow">while</span> (1);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </dd></dl>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="ga40243a242aa3fc9a23d8555457058312"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__CLOCK.html#ga40243a242aa3fc9a23d8555457058312">clock_option</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clock configuration available for MCU. </p>
<p>In theory the clock speed can be reduced further by increaing the division of the CLKPR register (see source code). Although with the USBASP, frequencies lower than 600kHz will case the programmer to no longer be able to comunicate with the MCU and no more firmware can be uploaded.</p>
<p>Should the MCU become locked under these conditions, the device can be powered on with the reset pin held low, causing no application code to run. The device can then be flashed with a higher clock speed to be unlocked. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="gga40243a242aa3fc9a23d8555457058312ac83f1e2e369ff060c66b518828798f2d"></a>CLOCK_IN_9_6M&#160;</td><td class="fielddoc">
<p>Internal oscillator, divided to 9.6MHz final. </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga40243a242aa3fc9a23d8555457058312aae66432d2aa7eff3a99013b785781c9c"></a>CLOCK_IN_4_8M&#160;</td><td class="fielddoc">
<p>Internal oscillator, divided to 4.8MHz final. </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga40243a242aa3fc9a23d8555457058312a6b89bb11fc5f9962e35a4f9bf996d7a9"></a>CLOCK_IN_2_4M&#160;</td><td class="fielddoc">
<p>Internal oscillator, divided to 2.4MHz final. </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga40243a242aa3fc9a23d8555457058312a82dd2db4e9216b7df71085a268474889"></a>CLOCK_IN_1_2M&#160;</td><td class="fielddoc">
<p>Internal oscillator, divided to 1.2MHz final. </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga40243a242aa3fc9a23d8555457058312ac2a739bbcbab27095cb131e3eb5890ea"></a>CLOCK_IN_600K&#160;</td><td class="fielddoc">
<p>Internal oscillator, divided to 600kHz final. </p>
</td></tr>
</table>

<p>Definition at line <a class="el" href="attiny13a__clock_8h_source.html#l00060">60</a> of file <a class="el" href="attiny13a__clock_8h_source.html">attiny13a_clock.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga3199fc3077a8e5f69aaaea0e45c28927"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t CLOCK_getSpeed </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current clock speed of the device. </p>
<dl class="section return"><dt>Returns</dt><dd>The current speed of the CPU bus in hertz. (Clock frequency) </dd></dl>

<p>Definition at line <a class="el" href="attiny13a__clock_8c_source.html#l00064">64</a> of file <a class="el" href="attiny13a__clock_8c_source.html">attiny13a_clock.c</a>.</p>

</div>
</div>
<a class="anchor" id="gad7074133d8bc7d5bfe85f43bd813e378"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t CLOCK_getSpeedAlternate </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current clock divisor. </p>
<p>This can be used to return the clock divisor for division in the main application.</p>
<p>A sample usage of this application is in <a class="el" href="group__CORE.html#ga25f9be571ac3f6bb5a8027a29eb4e629" title="Millisecond blocking delay. ">delayms()</a> of <a class="el" href="attiny13a__core_8h.html" title="Generic header file for all modules. ">attiny13a_core.h</a></p>
<dl class="section return"><dt>Returns</dt><dd>The current speed of the CPU clock bus.</dd></dl>
<ul>
<li>CLOCK_IN_9_6M - Divisor = 0</li>
<li>CLOCK_IN_4_8M - Divisor = 1</li>
<li>CLOCK_IN_2_4M - Divisor = 2</li>
<li>CLOCK_IN_1_2M - Divisor = 3</li>
<li>CLOCK_IN_600K - Divisor = 4 </li>
</ul>

<p>Definition at line <a class="el" href="attiny13a__clock_8c_source.html#l00071">71</a> of file <a class="el" href="attiny13a__clock_8c_source.html">attiny13a_clock.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga1c0fb75e4c7de12f534ad46014d35611"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DEBUG.html#ga90d6d08ec193c9751b20ce1d143b7f3c">mcu_error</a> CLOCK_setSpeed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__CLOCK.html#ga40243a242aa3fc9a23d8555457058312">clock_option</a>&#160;</td>
          <td class="paramname"><em>option</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the final clock speed of the device. </p>
<p>If this function isn't used, the default speed of 9.6MHz will be used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">option</td><td>The clock speed option to use defined by <a class="el" href="group__CLOCK.html#ga40243a242aa3fc9a23d8555457058312" title="Clock configuration available for MCU. ">clock_option</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error number as defined in <a class="el" href="group__DEBUG.html#ga90d6d08ec193c9751b20ce1d143b7f3c" title="Error enumerators for the Debug peripheral. ">mcu_error</a>, <a class="el" href="group__DEBUG.html#gga90d6d08ec193c9751b20ce1d143b7f3ca7a502a84e0dec2f0a7d34f13d7f2448e" title="Error clock: Clock speed doesn&#39;t exist. ">E_CLOCK_NOSPEED</a> if clock option doesn't exist. </dd></dl>

<p>Definition at line <a class="el" href="attiny13a__clock_8c_source.html#l00020">20</a> of file <a class="el" href="attiny13a__clock_8c_source.html">attiny13a_clock.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
